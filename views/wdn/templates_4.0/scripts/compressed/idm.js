define(["wdn","jquery","require"],function(e,t,n){"use strict";var i,r=function(e){return t("link[rel="+e+"]")},o=function(){var t=r("login"),n=r("logout");return t.length&&e.setPluginParam("idm","login",t.attr("href")),n.length&&e.setPluginParam("idm","logout",n.attr("href")),e.getPluginParam("idm")||{}},u="#wdn_",a=u+"identity_management",l=u+"idm_",s=l+"username",g=l+"logout",d="https://login.unl.edu/",c="unl_sso",f=encodeURIComponent(window.location),m=d+"cas/logout?url="+f,p=d+"cas/login?service="+f,v=d+"services/whoami/?id=",L="//planetred.unl.edu/pg/",N="Review and update your profile",h="Log in to UNL",y=!1,P=function(e){var t=e;return e?y.uid&&y.uid===e?U():t:U()},U=function(){var e="";return y.eduPersonNickname?e=y.eduPersonNickname[0]:y.givenName?e=y.givenName[0]:y.displayName&&(e=y.displayName[0]),e},k=function(e){return y&&y[e]?y[e][0]:!1},I={initialize:function(r){var u=function(){t(function(){var e=o();i=t(s).text(),e.login?I.setLoginURL(e.login):I.displayLogin()}),r&&r()},a=e.getCookie(c);a?n([v+a],function(){e.idm.user&&(y=e.idm.user,delete e.idm.user),I.getUserId()?(r&&r(),t(function(){I.displayNotice(I.getUserId())})):(I.logout(),u())}):u()},logout:function(){e.setCookie(c,"0",-1),y=!1},isLoggedIn:function(){return!!I.getUserId()},getUserId:function(){return y&&y.uid},getDisplayName:function(){return U()},getFirstName:function(){return k("givenName")},getLastName:function(){return k("sn")},getPrimaryAffiliation:function(){return k("eduPersonPrimaryAffiliation")},getEmailAddress:function(){return k("mail")},getPostalAddress:function(){return k("postalAddress")},getTelephoneNumber:function(){return k("telephoneNumber")},getTitle:function(){return k("title")},displayNotice:function(e){var n=o(),i=t(a),r=t(s);i.removeClass("hidden");var u="unl_";u+="s-"===e.substring(2,0)?e.replace("-","_"):e,i.addClass("loggedin"),r.css("backgroundImage","url("+L+"icon/"+u+"/topbar/)").attr("href","http:"+L+"profile/"+u).attr("title",N).text(P(e));var l=t("a",g);l.off("click").click(I.logout),I.setLogoutURL(n.logout)},displayLogin:function(){var e=t(a),n=t(s);e.removeClass("hidden loggedin"),n.css("backgroundImage",null).attr("href",p).attr("title",h).text(i)},setLogoutURL:function(e){var n=t("a",g);e&&(m=e),n.attr("href",m)},setLoginURL:function(e){e&&(p=e),I.displayLogin()}};return e.idm={},I});
//# sourceMappingURL=idm.js.map